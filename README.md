# Проект Foodgram, «Продуктовый помощник»

CI/CD foodgram: ![status](https://github.com/FanisGi/foodgram-project-react/actions/workflows/foodgram_workflow.yml/badge.svg)

## Описание

Сервис позволяет пользователям публиковать рецепты, подписываться на публикации других пользователей, добавлять понравившиеся рецепты в список «Избранное», а перед походом в магазин скачивать сводный список продуктов, необходимых для приготовления одного или нескольких выбранных блюд.

Сервис состоит из ключевых моделей:

1. Рецепт

* Автор публикации (пользователь)
* Название
* Картинка
* Текстовое описание
* Ингредиенты (продукты для приготовления блюда по рецепту. Множественное поле, выбор из предустановленного списка, с указанием количества и единицы измерения)
* Тег (можно установить несколько тегов на один рецепт, выбор из предустановленных)
* Время приготовления в минутах

2. Тег

* Название
* Цветовой HEX-код
* Slug

3. Ингредиент
**Данные об ингредиентах хранятся в нескольких связанных таблицах.**

* Название
* Количество
* Единицы измерения
______________________________________________________

## Что может сервис

### Для авторизованных пользователей:

* Доступна главная страница c рецептами.

* Доступна страница другого пользователя с его рецептами.

* Доступна страница отдельного рецепта с его описанием.

* Доступна страница «Мои подписки».
 
    1. Можно подписаться и отписаться на странице рецепта.
    2. Можно подписаться и отписаться на странице автора.
    3. При подписке рецепты автора добавляются на страницу «Мои подписки» и удаляются оттуда при отказе от подписки.

* Доступна страница «Избранное».
 
    1. На странице рецепта есть возможность добавить рецепт в список избранного и удалить его оттуда.
    2. На любой странице со списком рецептов есть возможность добавить рецепт в список избранного и удалить его оттуда.

* Доступна страница «Список покупок».

    1. На странице рецепта есть возможность добавить рецепт в список покупок и удалить его оттуда.
    2. На любой странице со списком рецептов есть возможность добавить рецепт в список покупок и удалить его оттуда.
    3. Есть возможность выгрузить файл **.txt** с перечнем и количеством необходимых ингредиентов для рецептов из «Списка покупок».
    4. Ингредиенты в выгружаемом списке не повторяются, корректно подсчитывается общее количество для каждого ингредиента.

* Доступна страница «Создать рецепт».
 
    1. Есть возможность опубликовать свой рецепт.
    2. Есть возможность отредактировать и сохранить изменения в своём рецепте.
    3. Есть возможность удалить свой рецепт.

* Доступна и работает форма изменения пароля.
* Доступна возможность выйти из системы (разлогиниться).

### Для неавторизованных пользователей

* Доступна главная страница.
* Доступна страница отдельного рецепта.
* Доступна и работает форма авторизации.
* Доступна и работает система восстановления пароля.
* Доступна и работает форма регистрации.

### Администратор и админ-зона

* Все модели выведены в админ-зону.
* Для модели пользователей включена фильтрация по имени и email.
* Для модели рецептов включена фильтрация по названию, автору и тегам.
* На админ-странице рецепта отображается общее число добавлений этого рецепта в избранное.
* Для модели ингредиентов включена фильтрация по названию.

Полное описание будет доступно по эндпоинту **.../api/docs**.

Если автор заплатил за аренду сервер, то детально изучить сервис можно по ссылке: **http://84.201.165.117/**
(Для входа в админ-зону по эндпоинту **.../admin/** используйте email: **admin@mail.ru**, пароль: **admin**)
______________________________________________________

## Ключевые технологии

* Python 3.7
* Django 3.2
* Djagorestframework 3.14 
* djoser 2.1
* docker 20.10
* docker-compose 1.25
* nginx 1.18
* gunicorn 20.0
* psycopg2-binary 2.8
_____________________________________________________

## Установка

### Установка на локальной машине

1. Cклонируйте репозитарий:

`git clone git@github.com:FanisGi/foodgram-project-react.git`

2. Cоздайте и активируйте виртуальное окружение:

```
# Для MacOS и Linux
python3 -m venv venv && . venv/bin/activate

# Для Windows
python -m venv venv && . venv/Scripts/activate
```

3. Установите все зависимости из файла requirements.txt:

`pip install -r requirements.txt`

4. Установите (если ещё у Вас его нету) **docker** и **docker-compose**.
Инструкция по установке есть **https://docs.docker.com/**

5. Из директории **/infra/local** выполните командy:

`docker-compose up -d --build`

6. Из директории **/infra/** создайте и заполните его данными файл **.env**:

```
DB_ENGINE=<django.db.backends.postgresql>
DB_NAME=<имя базы данных postgres>
DB_USER=<пользователь бд>
DB_PASSWORD=<пароль>
DB_HOST=<db>
DB_PORT=<5432>
SECRET_KEY=<секретный ключ проекта django>
```

7. Выполните миграции, загрузите статику и подготовленную базу с ингредиентами и тегами, создайте суперпользователя:

```
docker-compose exec -T backend python manage.py makemigrations recipes
docker-compose exec -T backend python manage.py migrate
docker-compose exec -T backend python manage.py collectstatic --no-input
docker-compose exec -T backend python manage.py load_db --import_all
docker-compose exec -T backend python manage.py createsuperuser
```

8. Сервис будет доступен по **http://localhost/**.

### Установке на удаленном сервере

1. Cклонируйте репозитарий и создайте копию проекта в своём профиле **github**:

`git clone git@github.com:FanisGi/foodgram-project-react.git`

2. Установите (если ещё у Вас его нету) **docker** и **docker-compose**.
Инструкция по установке есть **https://docs.docker.com/engine/install/ubuntu/**

3. Из директории **/infra/** скопируйте на сервер docker-compose.yaml и nginx.conf. Это можно сделать, например, по SSH:

```
# scp [путь к файлу] [имя пользователя]@[имя сервера/ip-адрес]:[путь к файлу]. Например:
scp /home/test.txt root@123.123.123.123:/directory
```

4. В репозитории проекта на **github** в **Secrets** создайте переменные окружения для работы:

```
DB_ENGINE=<django.db.backends.postgresql>
DB_NAME=<имя базы данных postgres>
DB_USER=<пользователь бд>
DB_PASSWORD=<пароль>
DB_HOST=<db>
DB_PORT=<5432>

DOCKER_PASSWORD=<пароль от DockerHub>
DOCKER_USERNAME=<имя пользователя>

SECRET_KEY=<секретный ключ проекта django>

HOST_IP=<username для подключения к серверу>
USER_HOST=<IP сервера>
PASSPHRASE_FOR_HOST=<пароль для сервера, если он установлен>
SSH_KEY=<ваш SSH ключ (для получения команда c терминала **cat ~/.ssh/id_rsa**)>

TELEGRAM_TO=<ID чата, в который придет сообщение>
TELEGRAM_TOKEN=<токен вашего бота>
```

5. С локальной машины выполните команду `git push`. Это запустит CI/CD по файлу **foodrgam_workflow.yml**.
Дождитесь завершения всех задач.

6. Выполните миграции, загрузите статику и подготовленную базу с ингредиентами и тегами, создайте суперпользователя:

```
sudo docker-compose exec -T backend python manage.py makemigrations recipes
sudo docker-compose exec -T backend python manage.py migrate
sudo docker-compose exec -T backend python manage.py collectstatic --no-input
sudo docker-compose exec -T backend python manage.py load_db --import_all
sudo docker-compose exec -T backend python manage.py createsuperuser
```

7. Сервис готов к использованию.
_____________________________________________________

## Автор

Gilazov Fanis
